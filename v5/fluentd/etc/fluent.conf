<source>
  @type tail
  path /var/log/containers/*.log
  pos_file /var/log/fluentd-containers.log.pos
  tag kube.*
  read_from_head true
  <parse>
    @type json
    time_format %Y-%m-%dT%H:%M:%S.%NZ
  </parse>
</source>

<filter kube.**>
  @type record_transformer
  <record>
    container_name ${record["kubernetes"]["container_name"]}
    namespace_name ${record["kubernetes"]["namespace_name"]}
    pod_name ${record["kubernetes"]["pod_name"]}
  </record>
</filter>

<match **>
  @type elasticsearch
  host ELASTICSEARCH_SERVICE_IP # Elasticsearch 서비스의 Cluster IP 또는 DNS 이름으로 변경해야 합니다.
  port 9200
  scheme http
  logstash_format true
  logstash_prefix kubernetes
  logstash_dateformat %Y%m%d
  include_tag_key true
  tag_key @log_name
</match>
